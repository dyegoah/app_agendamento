<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel da Loja - Dark Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --bg-dark: #111418;
      --bg-card: #1b1f25;
      --text-light: #e9ecef;
      --text-muted: #adb5bd;
      --blue: #2b4c7e;
      --green: #1c7c54;
      --red: #b02a37;
      --orange: #d97706;
      --pink: #e05eb5;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-light);
      font-family: 'Inter', sans-serif;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 240px;
      height: 100vh;
      background: var(--bg-card);
      padding: 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .sidebar h5 {
      font-weight: 600;
      color: var(--pink);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sidebar a {
      color: var(--text-muted);
      text-decoration: none;
      padding: 0.7rem 1rem;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background 0.2s, color 0.2s;
    }

    .sidebar a:hover {
      background: rgba(255,255,255,0.08);
      color: #fff;
    }

    main {
      margin-left: 250px;
      padding: 2rem;
      min-height: 100vh;
    }

    .card-dark {
      background: var(--bg-card);
      border: none;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      color: var(--text-light);
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .card-dark h2, .card-dark h4 {
      margin: 0;
      font-weight: 600;
    }

    .table-dark-custom {
      background: var(--bg-card);
      border-radius: 10px;
      overflow: hidden;
    }

    .table-dark-custom thead {
      background: #22262d;
      color: #dee2e6;
    }

    .table-dark-custom tbody tr {
      border-bottom: 1px solid #2c3038;
    }

    .badge-status {
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 0.85rem;
      color: #fff;
    }

    .bg-success { background-color: var(--green) !important; }
    .bg-warning { background-color: var(--orange) !important; }
    .bg-danger { background-color: var(--red) !important; }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h5><i class="bi bi-flower1"></i> Jamille</h5>
    <a href="#"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="#"><i class="bi bi-calendar-event"></i> Agendamentos</a>
    <a href="#"><i class="bi bi-list-task"></i> Serviços</a>
    <a href="#"><i class="bi bi-people"></i> Clientes</a>
    <a href="#"><i class="bi bi-cash-stack"></i> Financeiro</a>
    <a href="#"><i class="bi bi-gear"></i> Configurações</a>
    <a href="/logout"><i class="bi bi-box-arrow-right"></i> Sair</a>
  </div>

  <!-- Main -->
  <main>
    <h3 class="mb-4">Painel da Loja</h3>

    <!-- Cards superiores -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card-dark text-center" style="background-color:#2b4c7e;">
          <h6>Agendamentos do Mês</h6>
          <h2 id="totalAg">0</h2>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card-dark text-center" style="background-color:#1c7c54;">
          <h6>Serviço Mais Vendido</h6>
          <h4 id="servicoTop">-</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card-dark text-center" style="background-color:#b02a37;">
          <h6>Receita do Mês</h6>
          <h2 id="receitaMes">R$ 0,00</h2>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card-dark text-center" style="background-color:#d97706;">
          <h6>Próximo Agendamento</h6>
          <h4 id="proximoAg">-</h4>
        </div>
      </div>
    </div>

    <!-- Tabela de agendamentos -->
    <div class="card-dark mt-4">
      <h5 class="mb-3">Agendamentos Recentes</h5>
      <table class="table table-dark-custom table-striped align-middle text-light">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Data</th>
            <th>Serviço</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tabelaAgend">
          <tr><td>Maria</td><td>23/04/2024</td><td>Maquiagem Básica</td><td><span class="badge-status bg-success">Pago</span></td></tr>
          <tr><td>Joana</td><td>21/04/2024</td><td>Maquiagem Festa</td><td><span class="badge-status bg-warning">Pendente</span></td></tr>
          <tr><td>Fernanda</td><td>20/04/2024</td><td>Maquiagem Noiva</td><td><span class="badge-status bg-danger">Cancelado</span></td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // captura o lojaId vindo da URL
    const url = new URL(window.location.href);
    const lojaId = url.searchParams.get('lojaId');
    const brl = v => (Number(v||0)).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    if (lojaId) {
      fetch(`/api/loja/${lojaId}/dashboard`)
        .then(r=>r.json())
        .then(d=>{
          document.getElementById('totalAg').textContent = d.agendamentos || 0;
          document.getElementById('servicoTop').textContent = d.servicoMaisVendido || '-';
          document.getElementById('receitaMes').textContent = brl(d.receitaMes);
          document.getElementById('proximoAg').textContent = d.proximoAgendamento || '-';
        })
        .catch(()=>console.log('⚠️ Não foi possível carregar dados da loja.'));
    }
  </script>
</body>
</html>
