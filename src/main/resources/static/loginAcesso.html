<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Acesso ao Sistema 8.0</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #007bff, #00b4d8);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      width: 380px;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    .btn-custom {
      width: 100%;
      border-radius: 10px;
      font-weight: 500;
    }
    .alerta {
      display: none;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="card bg-white">
    <h4 class="text-center text-primary fw-bold mb-3">Acesso ao Sistema 8.0</h4>
    <p class="text-center text-muted mb-4">Insira suas credenciais para continuar</p>

    <!-- 
      Importante:
      - action="login" (sem barra inicial) respeita o context-path automaticamente
      - name="email" e name="senha" casam com o SecurityConfig
    -->
    <form id="formLogin" method="post" action="login">
      <div class="mb-3">
        <label class="form-label fw-semibold">E-mail</label>
        <input type="email" id="emailLogin" name="email" class="form-control" placeholder="exemplo@email.com" required>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Senha</label>
        <input type="password" id="senhaLogin" name="senha" class="form-control" placeholder="Digite sua senha" required>
      </div>

      <div class="text-center mb-2">
        <div id="msgErro" class="alert alert-danger alerta"></div>
        <div id="msgInfo" class="alert alert-info alerta"></div>
      </div>

      <button type="submit" class="btn btn-primary btn-custom mb-2">
        <i class="bi bi-box-arrow-in-right"></i> Entrar
      </button>

      <button type="button" class="btn btn-outline-secondary btn-custom" id="btnPrimeiroAcesso">
        <i class="bi bi-person-plus"></i> Primeiro Acesso
      </button>
    </form>

    <hr class="my-3">
    <p class="text-center small text-muted mb-0">© 2025 - Sistema 8.0</p>
  </div>

  <script>
    // Exibe mensagens vindas do Spring Security (?error, ?logout)
    (function () {
      const params = new URLSearchParams(window.location.search);
      const erro = params.get('error');
      const logout = params.get('logout');

      const msgErro = document.getElementById('msgErro');
      const msgInfo = document.getElementById('msgInfo');

      if (erro) {
        msgErro.textContent = "Usuário ou senha inválidos. Verifique suas credenciais.";
        msgErro.style.display = "block";
      }
      if (logout) {
        msgInfo.textContent = "Você saiu do sistema com sucesso.";
        msgInfo.style.display = "block";
      }
    })();

    // Navega para o cadastro respeitando o context-path automaticamente
    document.getElementById('btnPrimeiroAcesso').addEventListener('click', function () {
      // usar caminho relativo sem barra inicial para honrar o context-path (/app_agendamento, se houver)
      window.location.href = 'cadastroLojas.html';
    });
  </script>
  
  <script>
    // Se não existir loja/senha → manda para o cadastro
    (async () => {
      try {
        const r = await fetch(`${window.location.origin}/api/lojas/existe`);
        if (r.ok) {
          const { existe } = await r.json();
          if (!existe) {
            window.location.href = 'cadastroLojas.html';
          }
        }
      } catch(e) {
        // Silencioso: se der erro de rede, mantém no login
        console.warn('Falha ao checar primeiro acesso:', e);
      }
    })();
  </script>

</body>
</html>
